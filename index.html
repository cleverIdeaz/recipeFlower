<script>
  let recipes = [];

  async function fetchRecipes() {
    try {
      const response = await fetch('http://localhost:3000/api/recipes');
      const data = await response.json();
      recipes = data;
      populateRecipeDropdown();
    } catch (error) {
      console.error('Error fetching recipes:', error);
    }
  }

  function populateRecipeDropdown() {
    const select = document.getElementById('recipeSelect');
    recipes.forEach((recipe, index) => {
      const option = document.createElement('option');
      option.value = index; // Use index as the value for easy access
      option.innerText = recipe.RecipeName;
      select.appendChild(option);
    });
  }

  function updateRecipeCard() {
    const select = document.getElementById('recipeSelect');
    const selectedIndex = select.value;

    if (selectedIndex === "") {
      return; // Exit if no recipe is selected
    }

    const selectedRecipe = recipes[selectedIndex];
    document.getElementById('recipeName').innerText = selectedRecipe.RecipeName;
    document.getElementById('recipeCategory').innerText = `${selectedRecipe.Category} | ${selectedRecipe.Subcategory}`;

    // Populate ingredients with hyperlinks
    const ingredientsList = document.getElementById('ingredientsList');
    ingredientsList.innerHTML = ''; // Clear previous ingredients
    const ingredientsArray = selectedRecipe.Ingredients.split(';');
    const linksArray = selectedRecipe.IngredientLinks.split(';');

    ingredientsArray.forEach((ingredient, index) => {
      const link = linksArray[index] ? `<a href="${linksArray[index]}" target="_blank">${ingredient}</a>` : ingredient;
      const li = document.createElement('li');
      li.innerHTML = link;
      ingredientsList.appendChild(li);
    });

    // Populate instructions
    const instructionsList = document.getElementById('instructionsList');
    instructionsList.innerHTML = ''; // Clear previous instructions
    const instructionsArray = selectedRecipe.Instructions.split(';');
    instructionsArray.forEach(instruction => {
      const li = document.createElement('li');
      li.innerText = instruction;
      instructionsList.appendChild(li);
    });
  }

  // Fetch recipes when the page loads
  fetchRecipes();
</script>